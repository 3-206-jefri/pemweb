# Product Review Analyzer

A full-stack web application for analyzing product reviews using AI-powered sentiment analysis and key point extraction.

## Features

✅ **User Input**: Users can input product reviews as text  
✅ **Sentiment Analysis**: Analyze sentiment (positive/negative/neutral) using Hugging Face  
✅ **Key Points Extraction**: Extract key points from reviews using Google Gemini  
✅ **React Frontend**: Interactive React application with form input and results display  
✅ **Database Integration**: Save analysis results to PostgreSQL (with SQLite fallback for development)  
✅ **Error Handling**: Comprehensive error handling and fallback mechanisms  
✅ **Loading States**: Loading indicators during API calls  
✅ **Review History**: Display all past reviews with their analysis results  

## Tech Stack

**Backend:**
- Python 3.13+
- Pyramid Web Framework
- SQLAlchemy (ORM)
- PostgreSQL / SQLite
- Hugging Face API (sentiment analysis)
- Google Generative AI / Gemini API (key points extraction)

**Frontend:**
- React 19
- Vite (build tool)
- Axios (HTTP client)

## Project Structure

```
product-review-analyzer/
├── backend/
│   ├── app/
│   │   ├── __init__.py          # Pyramid app config, routes, static view
│   │   ├── views.py             # API endpoints and view handlers
│   │   ├── models.py            # SQLAlchemy Review model
│   │   ├── huggingface_helper.py # Sentiment analysis (HF API + fallback)
│   │   └── genai_helper.py       # Key points extraction (Gemini API + fallback)
│   ├── development.ini           # Pyramid development config
│   ├── setup.py                  # Backend dependencies
│   ├── init_db.py                # DB initialization script
│   └── development.db            # SQLite database (dev)
├── frontend/
│   └── frontend/
│       ├── src/
│       │   ├── App.jsx           # Main React component (form + results)
│       │   ├── main.jsx          # React entry point
│       │   ├── App.css           # Styles
│       │   └── index.css         # Global styles
│       ├── vite.config.js        # Vite config with API proxy
│       ├── package.json          # Frontend dependencies
│       ├── dist/                 # Built frontend (generated by `npm run build`)
│       └── index.html            # HTML template
└── README.md                     # This file
```

## Setup & Installation

### Prerequisites

- Python 3.13+ (for backend)
- Node.js 16+ (for frontend)
- npm or yarn
- PostgreSQL (optional, for production; dev uses SQLite)

### Backend Setup

1. **Create and activate virtual environment:**

```powershell
cd backend
python -m venv venv
.\venv\Scripts\Activate.ps1
```

2. **Install dependencies:**

```powershell
pip install -r requirements.txt
# or from setup.py:
pip install -e .
pip install pyramid waitress SQLAlchemy psycopg2-binary python-dotenv requests google-generativeai
```

3. **Create `.env` file (optional, for API keys):**

```env
# PostgreSQL (if using; dev defaults to sqlite:///development.db)
DATABASE_URL=postgresql://user:password@localhost:5432/review_analyzer

# Hugging Face sentiment analysis
HUGGINGFACE_TOKEN=your_hf_token
HUGGINGFACE_MODEL=cardiffnlp/twitter-roberta-base-sentiment

# Google Gemini key points extraction
GEMINI_API_KEY=your_gemini_api_key
```

4. **Initialize database (optional):**

```powershell
python init_db.py
```

> **Note**: Database tables are created automatically on first server startup if they don't exist.

### Frontend Setup

1. **Install dependencies:**

```powershell
cd frontend/frontend
npm install
```

2. **Build frontend:**

```powershell
npm run build
```

> Built files are output to `dist/` and will be served by the backend at `http://127.0.0.1:6543/`.

## Running the Application

### Option 1: Development (with Vite dev server)

**Terminal 1 - Backend:**

```powershell
cd backend
.\venv\Scripts\Activate.ps1
pserve .\development.ini
# Server runs on http://127.0.0.1:6543
```

**Terminal 2 - Frontend dev server:**

```powershell
cd frontend/frontend
npm run dev
# Vite dev server runs on http://localhost:5173 (usually)
# API proxy: /api/* → http://127.0.0.1:6543
```

Then open http://localhost:5173 in your browser.

### Option 2: Production (frontend build served by backend)

1. **Build frontend:**

```powershell
cd frontend/frontend
npm run build
```

2. **Start backend:**

```powershell
cd backend
.\venv\Scripts\Activate.ps1
pserve .\development.ini
# Server runs on http://127.0.0.1:6543
# Serves built frontend + API
```

Then open http://127.0.0.1:6543 in your browser.

## API Endpoints

### 1. POST `/api/analyze-review`

Analyze a product review and extract sentiment + key points.

**Request:**

```json
{
  "text": "Produk sangat bagus, kualitas terbaik dan harga terjangkau"
}
```

**Response:**

```json
{
  "result": {
    "id": 1,
    "text": "Produk sangat bagus, kualitas terbaik dan harga terjangkau",
    "sentiment": "positive",
    "key_points": [
      "Kualitas terbaik",
      "Harga terjangkau"
    ],
    "created_at": "2025-12-12T13:21:44.133307"
  }
}
```

**Error Response (500):**

```json
{
  "error": "sentiment error",
  "detail": "Error message..."
}
```

### 2. GET `/api/reviews`

Get all saved reviews with their analysis.

**Response:**

```json
{
  "reviews": [
    {
      "id": 1,
      "text": "Produk sangat bagus...",
      "sentiment": "positive",
      "key_points": ["..."],
      "created_at": "2025-12-12T13:21:44.133307"
    },
    ...
  ]
}
```

## Sentiment Analysis

### Hugging Face

The backend uses **Hugging Face Inference API** for sentiment analysis:
- Model: `cardiffnlp/twitter-roberta-base-sentiment` (default)
- Returns: positive, negative, or neutral sentiment

**Fallback:** If Hugging Face API is unavailable or model is missing, the backend uses a simple keyword-based heuristic.

**To use Hugging Face:**

1. Get token from https://huggingface.co/settings/tokens
2. Set `HUGGINGFACE_TOKEN` in `.env`
3. Optionally change model via `HUGGINGFACE_MODEL`

### Key Points Extraction

The backend uses **Google Generative AI (Gemini)** to extract key points:
- Model: `gemini-1.5-flash` (fast and cost-effective)
- Returns: JSON array of key points

**Fallback:** If Gemini API is unavailable or API key missing, the backend returns an empty array.

**To use Gemini:**

1. Get API key from https://aistudio.google.com/app/apikey
2. Set `GEMINI_API_KEY` in `.env`

## Database

### Schema

**Table: `reviews`**

| Column      | Type      | Description                    |
|-------------|-----------|--------------------------------|
| id          | Integer   | Primary key                    |
| text        | Text      | Review text (required)         |
| sentiment   | String    | positive/negative/neutral      |
| key_points  | Text      | JSON string of key points      |
| created_at  | DateTime  | Timestamp (UTC)                |

### Development Database

By default, the backend uses **SQLite** (`development.db`) for development.

### Production Database

For production, configure PostgreSQL:

1. Create database:

```sql
CREATE DATABASE review_analyzer;
```

2. Set `DATABASE_URL` environment variable:

```env
DATABASE_URL=postgresql://user:password@localhost:5432/review_analyzer
```

3. Run initialization (optional, tables auto-created):

```powershell
python init_db.py
```

## Error Handling

The application includes comprehensive error handling:

- **Invalid JSON**: Returns 400 with error message
- **Missing API keys**: Falls back to heuristics (sentiment) or empty results (key points)
- **Database errors**: Returns 500 with error details
- **External API failures**: Falls back to simple heuristics
- **Loading states**: UI shows "Analyzing..." while waiting

## Troubleshooting

### Backend won't start

```
Error: psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed
```

**Solution**: Backend automatically falls back to SQLite (`development.db`). Set correct `DATABASE_URL` or leave unset for dev.

### Frontend won't load

```
404 Not Found: /index.html
```

**Solution**: Run `npm run build` in `frontend/frontend` folder, then restart backend.

### API calls from frontend fail (dev)

**Solution**: Ensure Vite dev server is running and proxy is configured (`vite.config.js`). Vite automatically proxies `/api/*` to backend.

### Sentiment analysis returns "neutral" always

**Solution**: 
- Ensure `HUGGINGFACE_TOKEN` is set in `.env`
- Check token validity at https://huggingface.co/account/tokens
- May be using fallback heuristic (check backend logs)

### Key points extraction is empty

**Solution**:
- Ensure `GEMINI_API_KEY` is set in `.env`
- Check key validity at https://aistudio.google.com/app/apikey
- Backend falls back gracefully if API unavailable

## Performance & Deployment

### Caching

Static assets (CSS, JS) are served with `cache_max_age=0` for development. For production, adjust in `backend/app/__init__.py`:

```python
config.add_static_view('', dist_path, cache_max_age=3600)  # 1 hour
```

### Production Checklist

- [ ] Build frontend: `npm run build`
- [ ] Set `DATABASE_URL` to PostgreSQL
- [ ] Set API keys (`HUGGINGFACE_TOKEN`, `GEMINI_API_KEY`)
- [ ] Use production WSGI server (e.g., Gunicorn instead of Waitress)
- [ ] Enable HTTPS / SSL
- [ ] Configure CORS if frontend served from different domain
- [ ] Set up database backups
- [ ] Monitor API rate limits (Hugging Face, Gemini)

## Development Notes

### Running Tests

Currently, no automated tests are included. To add tests:

```powershell
pip install pytest pytest-pyramid
pytest
```

### Linting & Code Quality

**Backend:**

```powershell
pip install flake8 black
black app/
flake8 app/
```

**Frontend:**

```powershell
cd frontend/frontend
npm run lint
```

### Git Workflow

```powershell
git add .
git commit -m "Add feature: ..."
git push origin main
```

## Deliverables Checklist

✅ **Working backend API:**
- POST `/api/analyze-review` - Analyze new review
- GET `/api/reviews` - Get all reviews

✅ **React frontend:**
- Form input for product reviews
- Results display (sentiment + key points)
- Review history display
- Loading and error states

✅ **Database integration:**
- SQLAlchemy ORM
- SQLite (dev) + PostgreSQL (prod)
- Auto table creation on startup

✅ **Error handling:**
- Fallback for missing API keys
- Fallback for unavailable external services
- User-friendly error messages

✅ **Documentation:**
- This README with setup, API docs, troubleshooting

## Author

- **Name**: [Your Name]
- **NIM**: 123140206
- **GitHub**: https://github.com/3-206-jefri/pemweb.git

## License

MIT License - Feel free to use and modify this project.

## References

- Pyramid: https://docs.pylonsproject.org/projects/pyramid/
- SQLAlchemy: https://docs.sqlalchemy.org/
- React: https://react.dev/
- Vite: https://vite.dev/
- Hugging Face Inference API: https://huggingface.co/docs/inference-api
- Google Gemini API: https://ai.google.dev/

---

**Last Updated:** December 12, 2025
